---
- hosts: localhost
  gather_facts: no
  vars_files:
   - "tenant.yml"
  vars:
    # VPC,Subnet,Secgroup,ECS,EIP
    image_name: "{{ vms[ecs_name].image_name | default(default.image_name) }}"
    availability_zone: "{{ vms[ecs_name].availability_zone | default(default.availability_zone) }}"
    vpc_name: "{{ vms[ecs_name].vpc_name | default(default.vpc_name) }}"
    vpc_net: "{{ vms[ecs_name].vpc_net | default(default.vpc_net) }}"
    subnet_name: "{{ vms[ecs_name].subnet_name | default(default.subnet_name) }}"
    subnet_net: "{{ vms[ecs_name].subnet_net | default(default.subnet_net) }}"
    subnet_gateway: "{{ vms[ecs_name].subnet_gateway | default(default.subnet_gateway) }}"
    subnet_dhcp_enable: "{{ vms[ecs_name].subnet_dhcp_enable | default(default.subnet_dhcp_enable) }}"
    subnet_primary_dns: "{{ vms[ecs_name].subnet_primary_dns | default(default.subnet_primary_dns) }}"
    subnet_secondary_dns: "{{ vms[ecs_name].subnet_secondary_dns | default(default.subnet_secondary_dns) }}"
    secgroups: "{{ vms[ecs_name].secgroups | default(default.secgroups) }}"
    secgrouprules: "{{ securitygroups[secgroup_name] }}"
    ecs_ipaddress: "{{ vms[ecs_name].ecs_ipaddress | default() }}"
    public_ip_address: "{{ vms[ecs_name].ecs_publicip }}"
    ptr_name: "{{ vms[ecs_name].ecs_publicfqdn }}"
    eip_bandwidth_name: "{{ vms[ecs_name].eip_bandwidth_name | default(default.eip_bandwidth_name) }}"
    eip_bandwidth_size: "{{ vms[ecs_name].eip_bandwidth_size | default(default.eip_bandwidth_size) }}"
    ecs_volumetype: "{{ vms[ecs_name].ecs_volumetype | default(default.ecs_volumetype) }}"
    ecs_ram: "{{ vms[ecs_name].ecs_ram | default(default.ecs_ram) }}"
    ecs_vcpus: "{{ vms[ecs_name].ecs_vcpus | default(default.ecs_vcpus) }}"
    ecs_adminkey: "{{ vms[ecs_name].ecs_adminkey | default(default.ecs_adminkey) }}"
    keypair_file: "{{ vms[ecs_name].keypair_file | default(default.keypair_file) }}"
    # EVS
    evs_availability_zone: "{{ volumes[evs_name].evs_availability_zone | default(default.evs_availability_zone) }}"
    evs_volume_type: "{{ volumes[evs_name].evs_volume_type | default(default.evs_volume_type) }}"
    evs_size: "{{ volumes[evs_name].evs_size | default(default.evs_size) }}"
    evs_multiattach: "{{ volumes[evs_name].evs_multiattach | default(default.evs_multiattach) }}"
    evs_scsi: "{{ volumes[evs_name].evs_scsi | default(default.evs_scsi) }}"
    # ELB vars
    admin_state_up: "{{ elb[elb_name].admin_state_up | default(default.admin_state_up) }}"
    elb_availability_zone: "{{ elb[elb_name].elb_availability_zone | default(default.elb_availability_zone) }}"
    elb_bandwidth: "{{ elb[elb_name].elb_bandwidth | default(default.elb_bandwith) }}"
    elb_type: "{{ elb[elb_name].elb_type | default(default.elb_type) }}"
    elb_secgroup_name: "{{ elb[elb_name].elb_secgroup_name | default(default.elb_secgroup_name) }}"
    elb_subnet_name: "{{ elb[elb_name].elb_subnet_name | default(default.elb_subnet_name) }}"
    elb_vpc_name: "{{ elb[elb_name].elb_vpc_name | default(default.elb_vpc_name) }}"
    # ELB listener vars
    listener_protocol: "{{ elblistener[listener_name].listener_protocol | default(default.listener_protocol) }}"
    listener_port: "{{ elblistener[listener_name].listener_port | default(default.listener_port) }}"
    listener_backend_protocol: "{{ elblistener[listener_name].listener_backend_protocol | default(default.listener_backend_protocol) }}"
    listener_backend_port: "{{ elblistener[listener_name].listener_backend_port | default(default.listener_backend_port) }}"
    listener_lb_algorithm: "{{ elblistener[listener_name].listener_lb_algorithm | default(default.listener_lb_algorithm) }}"
    listener_certificate_name: "{{ elblistener[listener_name].listener_certificate_name | default('') }}"
    listener_tcp_timeout: "{{ elblistener[listener_name].listener_tcp_timeout | default('') }}"
    listener_cookie_timeout: "{{ elblistener[listener_name].listener_cookie_timeout | default('') }}"
    listener_sticky_session_type: "{{ elblistener[listener_name].listener_sticky_session_type | default('') }}"
    listener_session_sticky: "{{ elblistener[listener_name].listener_session_sticky | default('') }}"
    # ELB healthcheck vars
    healthcheck_connect_port: "{{ elblistener[listener_name].healthcheck_connect_port | default(default.healthcheck_connect_port) }}"
    healthcheck_interval: "{{ elblistener[listener_name].healthcheck_interval | default(0) }}"
    healthcheck_protocol: "{{ elblistener[listener_name].healthcheck_protocol | default('') }}"
    healthcheck_timeout: "{{ elblistener[listener_name].healthcheck_timeout | default(0) }}"
    healthcheck_uri: "{{ elblistener[listener_name].healthcheck_uri | default('') }}"
    unhealthy_threshold: "{{ elblistener[listener_name].unhealthy_threshold | default(0) }}"
    # ELB backend member vars
    backend_members: "{{ elblistener[listener_name].backend_members | default('') }}"
    # DNS vars
    zone_description: "{{ dnszones[zone_name].zone_description | default(default.zone_description) }}"
    zone_type: "{{ dnszones[zone_name].zone_type | default(default.zone_type) }}"
    zone_email: "{{ dnszones[zone_name].zone_email | default(default.zone_email) }}"
    zone_ttl: "{{ dnszones[zone_name].zone_ttl | default(default.zone_ttl) }}"
    zone_records: "{{ dnszonerecords[zone_name] }}"
    # playbook action
    localaction: "create"
